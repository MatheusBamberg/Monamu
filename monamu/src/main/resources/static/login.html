<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login - Sistema</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; background:#f3f4f6; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
    .card { background:#fff; padding:24px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.08); width: 360px; }
    h2 { margin:0 0 12px 0; font-size:20px; }
    label { display:block; margin-top:10px; font-size:13px; color:#333; }
    input[type="text"], input[type="password"] { width:100%; padding:10px; margin-top:6px; border:1px solid #d1d5db; border-radius:6px; }
    button { margin-top:16px; width:100%; padding:10px; border:0; background:#2563eb; color:white; border-radius:6px; font-weight:600; cursor:pointer; }
    .link { margin-top:12px; text-align:center; font-size:14px; }
    .error { margin-top:10px; color:#b91c1c; font-size:13px; }
    .success { margin-top:10px; color:#065f46; font-size:13px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>Entrar</h2>

    <label for="useusu">Usuário</label>
    <input id="useusu" type="text" autocomplete="username" />

    <label for="senhasusu">Senha</label>
    <input id="senhasusu" type="password" autocomplete="current-password" />

    <button id="btnLogin">Entrar</button>

    <div class="error" id="error" style="display:none"></div>
    <div class="success" id="success" style="display:none"></div>

    <div class="link">
      <a href="/register.html">Criar conta</a>
    </div>
  </div>

<script>
document.getElementById('btnLogin').addEventListener('click', async () => {
  const useusu = document.getElementById('useusu').value.trim();
  const senhasusu = document.getElementById('senhasusu').value;

  const errEl = document.getElementById('error');
  const okEl = document.getElementById('success');
  errEl.style.display = 'none';
  okEl.style.display = 'none';

  if (!useusu || !senhasusu) {
    errEl.textContent = 'Preencha usuário e senha.';
    errEl.style.display = 'block';
    return;
  }

  try {
    const res = await fetch('/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({ username: useusu, senha: senhasusu })
    });

    const text = await res.text();

    if (!res.ok) {
      errEl.textContent = text || ('Erro: ' + res.status);
      errEl.style.display = 'block';
      return;
    }

    // Login OK, redireciona para menu.html
    window.location.href = '/menu.html';

  } catch (e) {
    errEl.textContent = 'Erro ao conectar com o servidor.';
    errEl.style.display = 'block';
    console.error(e);
  }
});
</script>

</body>
</html>
